---
title: "Activity log"
author: "Jing Zhao"
date: "1/22/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  fig.align = 'center',
  message = FALSE, 
  warning = FALSE
  )
```

## Activity Log of UNSIAP Data Visulization E-Learning Course

```{r libraries}
library(stringr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(forcats)

```

## Import data

```{r data}
data_log <- read.csv("Data/logs_DTV20_20210121-1615.csv")

```
## Extract users ID

```{r}
log_new <- data_log %>%
  select(Description) %>%
  extract(Description, 'UserID', regex = "([\\d.]+)[^\\d.]", remove = FALSE) %>%
  mutate(data_log)

```

## Visualize some variables
Number of times the event was conducted
```{r}
log_new %>%
  filter(!is.na(Event.name)) %>%
  count(Event.name) %>%
  mutate(rank = dense_rank(desc(n))) %>% 
  filter(rank <= 20) %>% 
  ggplot()+
  aes(x=reorder(Event.name, -n), y=n)+
  geom_bar(stat='identity')+
  labs(
    #subtitle = "74 events in total, at the time 21 Januray 2021", x="Event", y="")+
    ##  To adapt....
    subtitle = paste(nrow(log_new),"( some text ", format(Sys.time(), "%Y-%m-%d"), ")")) +
  
  
  ggtitle("Number of times the event was conducted (top 22 events)")+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        plot.title = element_text(hjust = 0.5, size=12),
        panel.background = element_blank(), text = element_text(size=8), 
        axis.line = element_line(colour = "black"), 
        plot.subtitle = element_text(hjust = 0.5, size=8),
        axis.title.y = element_text(size = 10))+
  coord_flip()
  
```

Number of activity events each user engaged (top and bottom users)
```{r}
log_new %>%
  filter(!is.na(UserID)) %>%
  count(UserID) %>%
  mutate(rank = dense_rank(desc(n))) %>% 
  filter(row_number() >= max(row_number()) - 5 | rank <= 5) %>%
  ggplot()+
  aes(x=reorder(UserID, -n), y=n, 
      fill=factor(ifelse(rank <= 5,"Top 5","Bottom 5")))+
      geom_bar(stat='identity')+
  labs(subtitle = "333 users in total, at the time 21 Januray 2021", 
       x="Users' ID", y="", fill="")+
  ggtitle("Number of events each user engaged (top and bottom users)")+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        plot.title = element_text(hjust = 0.5, size=12), 
        plot.subtitle = element_text(hjust = 0.5, size=8),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))

```

